

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> frontend/src/utils/parser/robotCodeToSsotParsing/robotCodeToSsotParsing.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"></div><div class="category"><h2>Frontend</h2><h3>Modules</h3><ul><li><a href="frontend_src_utils_componentsFunctionality_notificationUtils.module_jsx.html">jsx</a></li><li><a href="module-frontend_src_api_routes_functionalities_functionalities.html">frontend/src/api/routes/functionalities/functionalities</a></li><li><a href="module-frontend_src_api_routes_robots_robots.html">frontend/src/api/routes/robots/robots</a></li><li><a href="module-frontend_src_api_routes_robots_rpaAttributes.html">frontend/src/api/routes/robots/rpaAttributes</a></li><li><a href="module-frontend_src_api_routes_robots_rpaParameter.html">frontend/src/api/routes/robots/rpaParameter</a></li><li><a href="module-frontend_src_api_routes_users_users.html">frontend/src/api/routes/users/users</a></li><li><a href="module-frontend_src_api_socketHandler_socketEmitter.html">frontend/src/api/socketHandler/socketEmitter</a></li><li><a href="module-frontend_src_api_socketHandler_socketListeners.html">frontend/src/api/socketHandler/socketListeners</a></li><li><a href="module-frontend_src_components_pages_RobotInteractionCockpit_robotInteractionCockpitFunctionality_robotInteractionCockpitFunctionality.html">frontend/src/components/pages/RobotInteractionCockpit/robotInteractionCockpitFunctionality/robotInteractionCockpitFunctionality</a></li><li><a href="module-frontend_src_components_pages_RobotModeler_ModelerSidebar_modelerSidebarFunctionality_downloadStringAsFile.html">frontend/src/components/pages/RobotModeler/ModelerSidebar/modelerSidebarFunctionality/downloadStringAsFile</a></li><li><a href="module-frontend_src_components_pages_RobotModeler_ModelerSidebar_modelerSidebarFunctionality_modelerSidebarFunctionality.html">frontend/src/components/pages/RobotModeler/ModelerSidebar/modelerSidebarFunctionality/modelerSidebarFunctionality</a></li><li><a href="module-frontend_src_utils_parser_bpmnToSsotParsing_bpmnToSsotParsing.html">frontend/src/utils/parser/bpmnToSsotParsing/bpmnToSsotParsing</a></li><li><a href="module-frontend_src_utils_parser_robotCodeToSsotParsing_robotCodeToSsotParsing.html">frontend/src/utils/parser/robotCodeToSsotParsing/robotCodeToSsotParsing</a></li><li><a href="module-frontend_src_utils_parser_ssotToBpmnParsing_ssotToBpmnParsing.html">frontend/src/utils/parser/ssotToBpmnParsing/ssotToBpmnParsing</a></li><li><a href="module-frontend_src_utils_sessionStorage_localFunctionalitiesController_functionalities.html">frontend/src/utils/sessionStorage/localFunctionalitiesController/functionalities</a></li><li><a href="module-frontend_src_utils_sessionStorage_localSsotController_attributes.html">frontend/src/utils/sessionStorage/localSsotController/attributes</a></li><li><a href="module-frontend_src_utils_sessionStorage_localSsotController_parameters.html">frontend/src/utils/sessionStorage/localSsotController/parameters</a></li><li><a href="module-frontend_src_utils_sessionStorage_localSsotController_ssot.html">frontend/src/utils/sessionStorage/localSsotController/ssot</a></li><li><a href="module-frontend_src_utils_sessionStorage_sessionStorageUtils.html">frontend/src/utils/sessionStorage/sessionStorageUtils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#BpmnModeler">BpmnModeler</a></li><li><a href="global.html#CreateRobotContainer">CreateRobotContainer</a></li><li><a href="global.html#Error">Error</a></li><li><a href="global.html#HeaderNavbar">HeaderNavbar</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#ModelerSidebar">ModelerSidebar</a></li><li><a href="global.html#PPApplicationDropdown">PPApplicationDropdown</a></li><li><a href="global.html#PPIdSection">PPIdSection</a></li><li><a href="global.html#PPNameSection">PPNameSection</a></li><li><a href="global.html#PPOutputValueSection">PPOutputValueSection</a></li><li><a href="global.html#PPParameterInput">PPParameterInput</a></li><li><a href="global.html#PPParameterSection">PPParameterSection</a></li><li><a href="global.html#PPRpaSection">PPRpaSection</a></li><li><a href="global.html#PPTaskDropdown">PPTaskDropdown</a></li><li><a href="global.html#PPTitleSection">PPTitleSection</a></li><li><a href="global.html#PropertiesPanel">PropertiesPanel</a></li><li><a href="global.html#removeUnsupportedBpmnFunctions">removeUnsupportedBpmnFunctions</a></li><li><a href="global.html#RobotContainer">RobotContainer</a></li><li><a href="global.html#RobotFile">RobotFile</a></li><li><a href="global.html#RobotFileSyntaxModal">RobotFileSyntaxModal</a></li><li><a href="global.html#RobotInteractionCockpit">RobotInteractionCockpit</a></li><li><a href="global.html#RobotInteractionExecutionSection">RobotInteractionExecutionSection</a></li><li><a href="global.html#RobotInteractionInputParameter">RobotInteractionInputParameter</a></li><li><a href="global.html#RobotInteractionInputSection">RobotInteractionInputSection</a></li><li><a href="global.html#RobotLogCard">RobotLogCard</a></li><li><a href="global.html#RobotModeler">RobotModeler</a></li><li><a href="global.html#RobotOverview">RobotOverview</a></li></ul></div><div class="category"><h2>Server</h2><h3>Modules</h3><ul><li><a href="module-server_utils_ssotToRobotParsing_generateCodeBase.html">server/utils/ssotToRobotParsing/generateCodeBase</a></li><li><a href="module-server_utils_ssotToRobotParsing_generateCodeForRpaTasks.html">server/utils/ssotToRobotParsing/generateCodeForRpaTasks</a></li><li><a href="module-server_utils_ssotToRobotParsing_retrieveParameters.html">server/utils/ssotToRobotParsing/retrieveParameters</a></li><li><a href="module-server_utils_ssotToRobotParsing_ssotToRobotParser.html">server/utils/ssotToRobotParsing/ssotToRobotParser</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>frontend/src/utils/parser/robotCodeToSsotParsing/robotCodeToSsotParsing.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @category Frontend
 * @module
 */

import {
  getRobotId,
  getRobotName,
} from '../../sessionStorage/localSsotController/ssot';

const {
  default: customNotification,
} = require('../../componentsFunctionality/notificationUtils');

const FOURSPACE = '    ';

/**
 * @returns {number} "uniqueId" which is just an increment from the counter in the local storage
 */
const getUniqueId = () => {
  const newId = JSON.parse(sessionStorage.getItem('idCounter')) + 1;
  sessionStorage.setItem('idCounter', newId);
  return newId;
};

/**
 * @returns {String} Unique Id; wrapped with the activity nomenclature
 */
const getActivityId = () => `Activity_0ay${getUniqueId()}`;

/**
 * @returns {String} Unique Id; wrapped with the event nomenclature
 */
const getEventId = () => `Event_0ay${getUniqueId()}`;

/**
 * @description Splits the robot code into an array and deletes all empty lines
 * @param {String} robotCode Code from the code editor
 * @returns {Array} Robot code without empty lines as an array
 */
const getRobotCodeAsArray = (robotCode) => {
  const robotCodeAsArray = robotCode.split('\n');
  for (let i = 0; i &lt; robotCodeAsArray.length; i += 1) {
    if (robotCodeAsArray[i] === '') {
      robotCodeAsArray.splice(i, 1);
      i -= 1;
    }
  }
  return robotCodeAsArray;
};

/**
 * @description Checks all lines of the settings section for the right syntax and returns all declared applications as an array
 * @param {Array} robotCodeSettingsSection All lines from the settings section as an array-entry (typeof string)
 * @returns {Array} All declared applications or undefined if an error occures
 */
const getApplicationArray = (robotCodeSettingsSection) => {
  if (typeof robotCodeSettingsSection === 'undefined') return undefined;
  const robotCode = robotCodeSettingsSection.slice(1);
  const availableApplications = JSON.parse(
    sessionStorage.getItem('availableApplications')
  );
  let errorWasThrown;

  robotCode.forEach((line) => {
    const regexForRpaAlias = /Library +RPA[.][a-zA-Z]+/;

    const elementStartsWithLibrary = line.startsWith('Library ');
    const rpaAliasIsCorrect = regexForRpaAlias.test(line);
    const applicationIsAvailable = availableApplications.includes(
      typeof line.split('RPA.')[1] === 'undefined'
        ? ''
        : line.split('RPA.')[1].trim()
    );

    if (!elementStartsWithLibrary) {
      customNotification(
        'Error',
        `Every line of the "*** Settings ***" Section has to start with "Library"! \nError location: "${line}"`
      );
      errorWasThrown = true;
      return;
    }
    if (!rpaAliasIsCorrect) {
      customNotification(
        'Error',
        `Application has to start with "RPA." \nError location: "${line}"`
      );
      errorWasThrown = true;
      return;
    }
    if (!applicationIsAvailable) {
      customNotification(
        'Error',
        `The Application "${String(
          line.split('RPA.')[1].trim()
        )}" is currently not supported. `
      );
      errorWasThrown = true;
    }
  });

  const declaredApplications = errorWasThrown
    ? undefined
    : robotCode.map((line) => line.split('RPA.')[1].trim());

  return declaredApplications;
};

/**
 * @description Retrieves the outputVariable name from the current code line
 * @param {String} currentLine Current line of RPAf code
 * @returns {String} Name of the outputVariable
 */
const getOutputName = (currentLine) => {
  const indexOfEqualsSign = currentLine.indexOf('=');
  return currentLine
    .slice(0, indexOfEqualsSign)
    .replace('${', '')
    .replace('}', '')
    .trim();
};

/**
 * @description Retrieves the rpa task from the current code line; if there are no parameters,
 * the indexOfFirstSplitPlaceholder returns -1 and therefore the function returns the whole line
 * @param {String} currentLine Current line of RPAf code
 * @param {String} splitPlaceholder Placeholder to split the string
 * @returns {String} RpaTask for the given code line
 */
const getRpaTask = (currentLine, splitPlaceholder) => {
  const indexOfFirstSplitPlaceholder = currentLine.indexOf(splitPlaceholder);
  return indexOfFirstSplitPlaceholder === -1
    ? currentLine.replace('RPA.', '')
    : currentLine.slice(0, indexOfFirstSplitPlaceholder).replace('RPA.', '');
};

/**
 * @description Retrieves the rpa parameters from the current code line
 * @param {String} currentLine Current line of RPAf code
 * @param {String} splitPlaceholder Placeholder to split the string
 * @param {String} instructionBlocks Current intruction block to get the rpaTask
 * @returns {Array} List of parameters for the current code line
 */
const getRpaParameters = (currentLine, splitPlaceholder) => {
  const indexOfFirstSplitPlaceholder = currentLine.indexOf(splitPlaceholder);
  const parametersWithoutRpaTask = currentLine.slice(
    indexOfFirstSplitPlaceholder + splitPlaceholder.length
  );
  return parametersWithoutRpaTask.split([splitPlaceholder]);
};

/**
 * @description Deletes everything before the first occurence of '=' and then trims all emptyspace until the rpa task name to get the expected format
 * @param {String} currentLine Current line of RPAf code
 * @param {String} splitPlaceholder Placeholder to split the string
 * @returns {String} The current line without the outputVariableName prefix
 */
const currentLineWithoutOutputValueName = (completeLine, splitPlaceholder) => {
  const indexOfEqualsSign = completeLine.indexOf('=');
  let currentLine = completeLine.slice(indexOfEqualsSign + 1);
  if (currentLine.startsWith(splitPlaceholder)) {
    currentLine = currentLine.replace(splitPlaceholder, '').trim();
  } else {
    currentLine = currentLine.trim();
  }
  return currentLine;
};

/**
 * @description Counts the number of occurences of the current task in the subset
 * of all Task/Application combinations for the current robot code
 * @param {Array} allMatchingCombinations All combinations from database that match the rpaTask
 * @param {*} rpaTask RpaTask from current robotCode line
 * @returns {Number} Number of occurrences of the rpaTask in allMatchingCombinations
 */
const numberOfOccurrencesOfTask = (allMatchingCombinations, rpaTask) => {
  let numberOfOccurrences = 0;
  allMatchingCombinations.forEach((singleObject) => {
    if (singleObject.task === rpaTask) {
      numberOfOccurrences += 1;
    }
  });
  return numberOfOccurrences;
};

/**
 * @description Returns the matching task object for the rpaTask or throws a notification
 * @param {String} rpaTask RpaTask from current robotCode line
 * @param {Array} allMatchingCombinations All combinations from database that match the rpaTask
 * @returns {Object} The matching task object for the rpaTask or undefined if an error occurs
 */
const returnMatchingCombination = (rpaTask, allMatchingCombinations) => {
  const numberOfOccurrences = numberOfOccurrencesOfTask(
    allMatchingCombinations,
    rpaTask
  );

  if (allMatchingCombinations.length === 0) {
    customNotification(
      'Error',
      `The described task "${rpaTask}" could not be assigned to an application.`
    );
    return undefined;
  }
  if (numberOfOccurrences > 1) {
    let correctExampleText = '';
    allMatchingCombinations.forEach((singleCombination) => {
      correctExampleText += `\n${singleCombination.application}.${rpaTask}`;
    });
    customNotification(
      'Error',
      `Multiple Applications with task "${rpaTask}" found. Give the full name you want to use like: ${correctExampleText}`
    );
    return undefined;
  }
  return allMatchingCombinations[0];
};

/**
 * @description "Preprocesses" the code in a usable data format
 * @param {Array} robotCodeTaskSection Robot code w/o empty lines as an array of Strings
 * @param {Array} taskAndApplicationCombinations All declared tasks and applications from database
 * @returns {Array} Array of instructionBlocks with the following schema:
 *      instructionBlocks = [rpaApplication:String, rpaTask:String, name:String, paramArray:Array]
 */
const getInstructionBlocksFromTaskSection = (
  robotCodeTaskSection,
  taskAndApplicationCombinations
) => {
  let errorWasThrown;
  const instructionBlocks = [];
  const regexForOutputValue = /\${(.)+} =/;
  const splitPlaceholder = 'ยง&amp;ยง';

  robotCodeTaskSection.slice(1).forEach((line) => {
    if (errorWasThrown) return;
    let currentLine = line;
    const currentLineIncludesSplitPlaceholder =
      currentLine.includes(splitPlaceholder);
    const currentLineDefinesOutputValue = regexForOutputValue.test(currentLine);
    const currentLineStartsWithFourspace = currentLine.startsWith(FOURSPACE);

    if (!currentLineStartsWithFourspace) {
      instructionBlocks.push({ name: currentLine });
      return;
    }

    if (currentLineIncludesSplitPlaceholder) {
      customNotification(
        'Error',
        `It is not allowed to use &amp; or ยง as param values \nError location: "${line}"`
      );
      errorWasThrown = true;
      return;
    }

    currentLine = currentLine.trim().replace(/( {4})/g, splitPlaceholder);

    if (currentLineDefinesOutputValue) {
      const outputValueName = getOutputName(currentLine);
      instructionBlocks[instructionBlocks.length - 1].outputName =
        outputValueName;

      currentLine = currentLineWithoutOutputValueName(
        currentLine,
        splitPlaceholder
      );
    }

    if (!errorWasThrown) {
      let rpaTask = getRpaTask(currentLine, splitPlaceholder);
      const allMatchingCombinations = taskAndApplicationCombinations.filter(
        (singleCombination) => {
          if (rpaTask === singleCombination.task) return true;
          if (
            rpaTask.endsWith(singleCombination.task) &amp;&amp;
            rpaTask.startsWith(singleCombination.application)
          )
            return true;

          return false;
        }
      );

      const matchingCombination = returnMatchingCombination(
        rpaTask,
        allMatchingCombinations
      );
      if (typeof matchingCombination === 'undefined') {
        errorWasThrown = true;
        return;
      }

      rpaTask = rpaTask.replace(`${matchingCombination.application}.`, '');

      const rpaParameters = getRpaParameters(currentLine, splitPlaceholder);

      instructionBlocks[instructionBlocks.length - 1].rpaTask = rpaTask;
      instructionBlocks[instructionBlocks.length - 1].paramArray =
        rpaParameters;
      instructionBlocks[instructionBlocks.length - 1].rpaApplication =
        matchingCombination.application;
    }
  });
  return errorWasThrown ? undefined : instructionBlocks;
};

/**
 * @description Builds a dummy startMarker element and returns them
 * @returns {Object} Dummy startMarker as JSON => currently MARKERS aren't defined
 * in our RPAf-Syntax and therefore there aren't implemented
 */
const buildStartMarker = () => ({
  successorIds: [],
  id: getEventId(),
  type: 'MARKER',
  name: 'START',
  predecessorIds: [],
});

/**
 * @description Builds a dummy endMarker element and returns them
 * @param {Object} predecessor As an Object to get the predecessorId
 * @returns {Object} Dummy endMarker as JSON => currently MARKERS aren't defined
 * in our RPAf-Syntax and therefore there aren't implemented
 */
const buildEndMarker = (predecessor) => ({
  successorIds: [],
  id: getEventId(),
  type: 'MARKER',
  name: 'END',
  predecessorIds: [predecessor ? predecessor.id : 'MarkerElement'],
});

/**
 * @description Builds the attributeObject for a single element
 * @param {Object} currentElement Current instruction element
 * @param {Object} singleElementFromTasksSection The parsed Object from the RPAf Code
 * @param {String} robotId The id of the current robot / ssot
 * @returns {Object} AttributeObject for a single attribute
 */
const buildSingleAttributeObject = (
  currentElement,
  singleElementFromTasksSection,
  robotId
) => {
  let { rpaTask } = singleElementFromTasksSection;
  if (!rpaTask) rpaTask = 'no Task defined';

  return {
    activityId: currentElement.id,
    rpaApplication: singleElementFromTasksSection.rpaApplication,
    rpaTask,
    robotId,
  };
};

/**
 * @description Builds the parameterObject for a single element
 * @param {Object} singleAtrributeObject The attribute Object of the current activity
 * @param {Object} singleElementFromTasksSection The parsed Object from the RPAf Code
 * @param {Array} taskAndApplicationCombinations All combinations of applications and tasks
 * @returns {Object} ParameterObject for a single attribute
 */
const buildSingleParameterObject = (
  singleAtrributeObject,
  singleElementFromTasksSection,
  taskAndApplicationCombinations
) => {
  const { rpaApplication, activityId, rpaTask, robotId } =
    singleAtrributeObject;
  const singleParamArray = singleElementFromTasksSection.paramArray;

  const combinationObject = taskAndApplicationCombinations.filter(
    (singleCombinationObject) =>
      singleCombinationObject.application === rpaApplication &amp;&amp;
      singleCombinationObject.task === rpaTask
  )[0];

  const parameterArray = combinationObject.inputVars.map(
    (singleParameter, index) => {
      const currentParameterIsEmpty =
        singleParamArray[index].startsWith('%%') &amp;&amp;
        singleParamArray[index].endsWith('%%');
      const currentParameterRequiresUserInput =
        singleParamArray[index].startsWith('!!') &amp;&amp;
        singleParamArray[index].endsWith('!!');
      const currentParameterTakesOutputValue =
        singleParamArray[index].startsWith('${') &amp;&amp;
        singleParamArray[index].endsWith('}');
      const singleParameterObject = { ...singleParameter };

      singleParameterObject.requireUserInput =
        currentParameterRequiresUserInput;
      if (currentParameterIsEmpty || currentParameterRequiresUserInput) {
        singleParameterObject.value = '';
      } else if (currentParameterTakesOutputValue) {
        const outputValueName = singleParamArray[index]
          .slice(2)
          .slice(0, singleParamArray[index].length - 3)
          .trim();
        singleParameterObject.value = `$$${outputValueName}$$`;
      } else {
        singleParameterObject.value = singleParamArray[index];
      }

      return singleParameterObject;
    }
  );

  return {
    activityId,
    rpaParameters: parameterArray,
    robotId,
    outputValue: singleElementFromTasksSection.outputName,
  };
};

/**
 * @description Build the elementsArray of the ssot
 * @param {Array} robotCodeTaskSection Robot code w/o empty lines as an array of Strings
 * @param {Array} declaredApplications All declared Aplications from ***settings*** section as Strings
 * @param {String} robotId The id of the current robot / ssot
 * @returns {Array} elementsArray with all needed properties
 */
const getElementsArray = (
  robotCodeTaskSection,
  declaredApplications,
  robotId
) => {
  const elementsArray = [];
  const attributeArray = [];
  const parameterArray = [];

  if (
    typeof robotCodeTaskSection === 'undefined' ||
    typeof declaredApplications === 'undefined'
  )
    return undefined;

  let taskAndApplicationCombinations = JSON.parse(
    sessionStorage.getItem('taskApplicationCombinations')
  );
  taskAndApplicationCombinations = taskAndApplicationCombinations.filter(
    (singleCombination) =>
      declaredApplications.includes(singleCombination.application)
  );

  const instructionArray = getInstructionBlocksFromTaskSection(
    robotCodeTaskSection,
    taskAndApplicationCombinations
  );
  if (typeof instructionArray === 'undefined') return undefined;

  elementsArray.push(buildStartMarker());

  instructionArray.forEach((singleElement) => {
    const currentElement = {};

    currentElement.successorIds = [];
    currentElement.id = getActivityId();
    currentElement.type = 'INSTRUCTION';
    currentElement.name = singleElement.name;

    const predecessor = elementsArray[elementsArray.length - 1];
    currentElement.predecessorIds = predecessor &amp;&amp; [predecessor.id];
    if (predecessor) predecessor.successorIds = [currentElement.id];

    elementsArray.push(currentElement);

    const singleAtrributeObject = buildSingleAttributeObject(
      currentElement,
      singleElement,
      robotId
    );
    attributeArray.push(singleAtrributeObject);

    const singleParameterObject = buildSingleParameterObject(
      singleAtrributeObject,
      singleElement,
      taskAndApplicationCombinations
    );
    parameterArray.push(singleParameterObject);
  });
  elementsArray.push(buildEndMarker(elementsArray[elementsArray.length - 1]));
  const lastElement = elementsArray[elementsArray.length - 1];
  const secontlLastElement = elementsArray[elementsArray.length - 2];
  secontlLastElement.successorIds = [lastElement.id];

  sessionStorage.removeItem('attributeLocalStorage');
  sessionStorage.setItem(
    'attributeLocalStorage',
    JSON.stringify(attributeArray)
  );
  sessionStorage.setItem(
    'parameterLocalStorage',
    JSON.stringify(parameterArray)
  );

  return elementsArray;
};

/**
 * @description Retrieves the starterId of the robot from the elements array
 * @param {Array} elementsArray Array of all elements of the robot
 * @returns {String} Id of the element that has no predecessors and is therefore the start element of the robot
 */
const getStarterId = (elementsArray) => {
  const starterElements = elementsArray.filter(
    (singleElement) =>
      singleElement.type === 'MARKER' &amp;&amp;
      singleElement.predecessorIds.length === 0
  );
  if (starterElements.length === 1) {
    return starterElements[0].id;
  }
  return 'no starter id found';
};

/**
 * @description Retrieves the line number for a given selector
 * @param {Array} robotCodeAsArray The complete robotCode w/o new lines as array
 * @param {String} selector The selector for which the line number will be retrieved
 * @returns {number} Line number where the selector occurs
 */
const getLineNumberForSelector = (robotCodeAsArray, selector) => {
  let lineNumber;
  robotCodeAsArray.forEach((codeLine, index) => {
    if (codeLine.trim().includes(selector)) lineNumber = index;
  });
  if (typeof lineNumber === 'undefined') {
    customNotification(
      'Error',
      `The required selector "${selector}" was not found`
    );
  }
  return lineNumber;
};

/**
 * @description Parses the RPA-Framework code from the code editor to the single source of truth
 * @param {String} robotCode Code from the code-editor
 * @returns {Object} Single source of truth as a JavaSctipt-object or undefined if an error occures
 */
const parseRobotCodeToSsot = (robotCode) => {
  const robotName = getRobotName();
  const robotId = getRobotId();
  const robotCodeAsArray = getRobotCodeAsArray(robotCode);

  const lineNumberSettingsSelector = getLineNumberForSelector(
    robotCodeAsArray,
    '*** Settings ***'
  );
  const lineNumberTasksSelector = getLineNumberForSelector(
    robotCodeAsArray,
    '*** Tasks ***'
  );

  let robotCodeSettingsSection;
  let robotCodeTaskSection;
  if (
    typeof lineNumberSettingsSelector !== 'undefined' &amp;&amp;
    typeof lineNumberTasksSelector !== 'undefined'
  ) {
    robotCodeSettingsSection = robotCodeAsArray.slice(
      lineNumberSettingsSelector,
      lineNumberTasksSelector
    );
    robotCodeTaskSection = robotCodeAsArray.slice(lineNumberTasksSelector);
  }

  const declaredApplications = getApplicationArray(robotCodeSettingsSection);
  const elementsArray = getElementsArray(
    robotCodeTaskSection,
    declaredApplications,
    robotId
  );

  if (typeof elementsArray !== 'undefined') {
    const ssot = {
      _id: robotId,
      starterId: getStarterId(elementsArray),
      robotName,
      elements: elementsArray,
    };
    return ssot;
  }
  return undefined;
};

export {
  parseRobotCodeToSsot,
  getLineNumberForSelector,
  getRobotCodeAsArray,
  getApplicationArray,
  getElementsArray,
  getInstructionBlocksFromTaskSection,
};
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

</body>
</html>
